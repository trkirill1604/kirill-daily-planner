# kirill-daily-planner
# kirill-daily-planner

Простой офлайн-ежедневник (PWA) с матрицей Эйзенхауэра, таймингом дня и шаблонами.

## Запуск

```bash
python3 -m http.server 8080
```

Откройте: `http://localhost:8080`

## Установка на Android (PWA)

1. Откройте приложение в Chrome.
2. Нажмите меню ⋮ → **Добавить на главный экран**.
3. Подтвердите установку — приложение появится как отдельное.

## Уведомления

Нажмите кнопку **Уведомления**, чтобы дать разрешение. Уведомления работают, пока приложение открыто или активно в фоне браузера.
app.js
Новый
+423
-0

const STORAGE_KEY = "plannerData";
const QUADRANT_ORDER = ["Q1", "Q2", "Q3", "Q4"];
const DAY_MS = 24 * 60 * 60 * 1000;

const state = {
  data: loadData(),
  currentDate: new Date(),
  notificationTimers: [],
};

const elements = {
  currentDate: document.getElementById("current-date"),
  prevDay: document.getElementById("prev-day"),
  nextDay: document.getElementById("next-day"),
  dayStart: document.getElementById("day-start"),
  taskTitle: document.getElementById("task-title"),
  taskQuadrant: document.getElementById("task-quadrant"),
  taskDuration: document.getElementById("task-duration"),
  addTask: document.getElementById("add-task"),
  taskList: document.getElementById("task-list"),
  templateSelect: document.getElementById("template-select"),
  applyTemplate: document.getElementById("apply-template"),
  saveTemplate: document.getElementById("save-template"),
  deleteTemplate: document.getElementById("delete-template"),
  weekView: document.getElementById("week-view"),
  monthView: document.getElementById("month-view"),
  yearView: document.getElementById("year-view"),
  notifyToggle: document.getElementById("notify-toggle"),
  tabButtons: document.querySelectorAll(".tab"),
};

function loadData() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) {
    return { days: {}, templates: {} };
  }
  try {
    return JSON.parse(raw);
  } catch (error) {
    return { days: {}, templates: {} };
  }
}

function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state.data));
}

function formatDate(date) {
  return date.toISOString().slice(0, 10);
}
Using `toISOString()` to build the date key forces UTC, which shifts the day for most non‑UTC timezones (e.g., local 2026‑01‑03 00:00 becomes `2026-01-02` in UTC+3). This causes the date input to display the wrong day and stores tasks under the previous/next date for users outside UTC. A local‑date formatter (e.g., based on `getFullYear()/getMonth()/getDate()` or `toLocaleDateString('sv-SE')`) avoids this mismatch.

function getDayData(dateKey) {
  if (!state.data.days[dateKey]) {
    state.data.days[dateKey] = {
      startTime: "08:00",
      tasks: [],
    };
  }
  return state.data.days[dateKey];
}

function parseTimeToMinutes(value) {
  const [hours, minutes] = value.split(":").map(Number);
  return hours * 60 + minutes;
}

function minutesToTime(value) {
  const hours = Math.floor(value / 60).toString().padStart(2, "0");
  const minutes = Math.floor(value % 60).toString().padStart(2, "0");
  return `${hours}:${minutes}`;
}

function getSortedTasks(tasks) {
  return [...tasks].sort((a, b) => {
    const quadrantDiff = QUADRANT_ORDER.indexOf(a.quadrant) - QUADRANT_ORDER.indexOf(b.quadrant);
    if (quadrantDiff !== 0) {
      return quadrantDiff;
    }
    return a.createdAt - b.createdAt;
  });
}

function buildSchedule(tasks, startTime) {
  let current = parseTimeToMinutes(startTime);
  return getSortedTasks(tasks).map((task) => {
    const start = current;
    const end = current + task.duration;
    current = end;
    return { ...task, start, end };
  });
}

function renderDay() {
  const dateKey = formatDate(state.currentDate);
  elements.currentDate.value = dateKey;
  const day = getDayData(dateKey);
  elements.dayStart.value = day.startTime;

  const schedule = buildSchedule(day.tasks, day.startTime);
  elements.taskList.innerHTML = "";

  if (schedule.length === 0) {
    elements.taskList.innerHTML = "<p class=\"task-meta\">Задач нет. Добавьте первую.</p>";
    return;
  }

  const template = document.getElementById("task-item-template");
  schedule.forEach((task) => {
    const clone = template.content.cloneNode(true);
    const item = clone.querySelector(".task-item");
    const title = clone.querySelector(".task-title");
    const meta = clone.querySelector(".task-meta");
    const toggleDone = clone.querySelector(".toggle-done");
    const moveTomorrow = clone.querySelector(".move-tomorrow");
    const deleteTask = clone.querySelector(".delete-task");

    title.textContent = task.title;
    meta.textContent = `${task.quadrant} · ${minutesToTime(task.start)}–${minutesToTime(task.end)} · ${task.duration} мин`;
    if (task.done) {
      item.style.opacity = "0.6";
      toggleDone.textContent = "Вернуть";
    }

    toggleDone.addEventListener("click", () => toggleTaskDone(dateKey, task.id));
    moveTomorrow.addEventListener("click", () => moveTaskTomorrow(dateKey, task.id));
    deleteTask.addEventListener("click", () => removeTask(dateKey, task.id));

    elements.taskList.appendChild(clone);
  });
}

function renderTemplates() {
  const select = elements.templateSelect;
  select.innerHTML = "";
  const templateNames = Object.keys(state.data.templates);
  const defaultOption = document.createElement("option");
  defaultOption.textContent = "Выбрать шаблон";
  defaultOption.value = "";
  select.appendChild(defaultOption);

  templateNames.forEach((name) => {
    const option = document.createElement("option");
    option.value = name;
    option.textContent = name;
    select.appendChild(option);
  });
}

function renderWeek() {
  const start = new Date(state.currentDate);
  const dayIndex = (start.getDay() + 6) % 7;
  start.setDate(start.getDate() - dayIndex);
  elements.weekView.innerHTML = "";

  for (let i = 0; i < 7; i += 1) {
    const day = new Date(start.getTime() + i * DAY_MS);
    const key = formatDate(day);
    const dayData = state.data.days[key];
    const cell = document.createElement("div");
    cell.className = "day-cell";
    cell.innerHTML = `<strong>${day.toLocaleDateString("ru-RU", { weekday: "short", day: "numeric" })}</strong>`;
    if (dayData) {
      const total = dayData.tasks.length;
      const done = dayData.tasks.filter((task) => task.done).length;
      cell.innerHTML += `${done}/${total} выполнено`;
    } else {
      cell.innerHTML += "Нет задач";
    }
    elements.weekView.appendChild(cell);
  }
}

function renderMonth() {
  const date = new Date(state.currentDate);
  date.setDate(1);
  const startDay = (date.getDay() + 6) % 7;
  elements.monthView.innerHTML = "";

  for (let i = 0; i < startDay; i += 1) {
    const empty = document.createElement("div");
    empty.className = "day-cell";
    elements.monthView.appendChild(empty);
  }

  while (date.getMonth() === state.currentDate.getMonth()) {
    const key = formatDate(date);
    const dayData = state.data.days[key];
    const cell = document.createElement("div");
    cell.className = "day-cell";
    cell.innerHTML = `<strong>${date.getDate()}</strong>`;
    if (dayData) {
      cell.innerHTML += `${dayData.tasks.length} задач`;
    }
    elements.monthView.appendChild(cell);
    date.setDate(date.getDate() + 1);
  }
}

function renderYear() {
  elements.yearView.innerHTML = "";
  const year = state.currentDate.getFullYear();
  for (let month = 0; month < 12; month += 1) {
    const first = new Date(year, month, 1);
    const keyPrefix = `${year}-${String(month + 1).padStart(2, "0")}`;
    const tasksCount = Object.keys(state.data.days)
      .filter((key) => key.startsWith(keyPrefix))
      .reduce((total, key) => total + state.data.days[key].tasks.length, 0);
    const cell = document.createElement("div");
    cell.className = "day-cell";
    cell.innerHTML = `<strong>${first.toLocaleDateString("ru-RU", { month: "short" })}</strong>`;
    cell.innerHTML += `${tasksCount} задач`;
    elements.yearView.appendChild(cell);
  }
}

function renderAll() {
  renderDay();
  renderTemplates();
  renderWeek();
  renderMonth();
  renderYear();
  scheduleNotifications();
}

function addTask() {
  const title = elements.taskTitle.value.trim();
  const duration = Number(elements.taskDuration.value);
  if (!title || Number.isNaN(duration) || duration <= 0) {
    return;
  }

  const dateKey = formatDate(state.currentDate);
  const day = getDayData(dateKey);
  day.tasks.push({
    id: crypto.randomUUID(),
    title,
    quadrant: elements.taskQuadrant.value,
    duration,
    done: false,
    createdAt: Date.now(),
  });

  elements.taskTitle.value = "";
  saveData();
  renderAll();
}

function toggleTaskDone(dateKey, taskId) {
  const day = getDayData(dateKey);
  const task = day.tasks.find((item) => item.id === taskId);
  if (task) {
    task.done = !task.done;
    saveData();
    renderAll();
  }
}

function removeTask(dateKey, taskId) {
  const day = getDayData(dateKey);
  day.tasks = day.tasks.filter((task) => task.id !== taskId);
  saveData();
  renderAll();
}

function moveTaskTomorrow(dateKey, taskId) {
  const day = getDayData(dateKey);
  const index = day.tasks.findIndex((task) => task.id === taskId);
  if (index === -1) return;
  const [task] = day.tasks.splice(index, 1);
  const tomorrow = new Date(state.currentDate.getTime() + DAY_MS);
  const tomorrowKey = formatDate(tomorrow);
  getDayData(tomorrowKey).tasks.push(task);
  saveData();
  renderAll();
}

function saveTemplate() {
  const name = prompt("Название шаблона:");
  if (!name) return;
  const dateKey = formatDate(state.currentDate);
  const day = getDayData(dateKey);
  state.data.templates[name] = {
    startTime: day.startTime,
    tasks: day.tasks.map((task) => ({
      ...task,
      id: crypto.randomUUID(),
    })),
  };
  saveData();
  renderTemplates();
}

function applyTemplate() {
  const name = elements.templateSelect.value;
  if (!name) return;
  const template = state.data.templates[name];
  const dateKey = formatDate(state.currentDate);
  state.data.days[dateKey] = {
    startTime: template.startTime,
    tasks: template.tasks.map((task) => ({
      ...task,
      id: crypto.randomUUID(),
      done: false,
      createdAt: Date.now(),
    })),
  };
  saveData();
  renderAll();
}

function deleteTemplate() {
  const name = elements.templateSelect.value;
  if (!name) return;
  delete state.data.templates[name];
  saveData();
  renderTemplates();
}

function updateStartTime() {
  const dateKey = formatDate(state.currentDate);
  const day = getDayData(dateKey);
  day.startTime = elements.dayStart.value;
  saveData();
  renderAll();
}

function changeDate(offset) {
  state.currentDate = new Date(state.currentDate.getTime() + offset * DAY_MS);
  renderAll();
}

function onDateInput() {
  state.currentDate = new Date(`${elements.currentDate.value}T00:00:00`);
  renderAll();
}

function setupTabs() {
  elements.tabButtons.forEach((button) => {
    button.addEventListener("click", () => {
      elements.tabButtons.forEach((item) => item.classList.remove("active"));
      button.classList.add("active");
      document.querySelectorAll(".tab-panel").forEach((panel) => panel.classList.remove("active"));
      document.getElementById(`tab-${button.dataset.tab}`).classList.add("active");
    });
  });
}

function clearNotificationTimers() {
  state.notificationTimers.forEach((timer) => clearTimeout(timer));
  state.notificationTimers = [];
}

function scheduleNotifications() {
  clearNotificationTimers();
  if (Notification.permission !== "granted") {
    return;
  }
  const dateKey = formatDate(state.currentDate);
  if (dateKey !== formatDate(new Date())) {
    return;
  }
  const day = getDayData(dateKey);
  const schedule = buildSchedule(day.tasks, day.startTime);
  const now = Date.now();

  schedule.forEach((task) => {
    if (task.done) return;
    const startTime = new Date();
    const [hours, minutes] = minutesToTime(task.start).split(":");
    startTime.setHours(Number(hours), Number(minutes), 0, 0);

    const fiveMinutesBefore = startTime.getTime() - 5 * 60 * 1000;
    [fiveMinutesBefore, startTime.getTime()].forEach((time, index) => {
      if (time <= now) return;
      const timer = setTimeout(() => {
        new Notification(index === 0 ? "Через 5 минут" : "Старт задачи", {
          body: `${task.title} (${task.quadrant})`,
        });
      }, time - now);
      state.notificationTimers.push(timer);
    });
  });
}

async function requestNotificationPermission() {
  if (!("Notification" in window)) {
    alert("Уведомления не поддерживаются этим браузером.");
    return;
  }
  const permission = await Notification.requestPermission();
  if (permission === "granted") {
    scheduleNotifications();
  }
}

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}

// Event listeners
setupTabs();

const today = new Date();
state.currentDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
renderAll();

elements.prevDay.addEventListener("click", () => changeDate(-1));
elements.nextDay.addEventListener("click", () => changeDate(1));
elements.currentDate.addEventListener("change", onDateInput);
elements.dayStart.addEventListener("change", updateStartTime);
elements.addTask.addEventListener("click", addTask);

elements.taskTitle.addEventListener("keydown", (event) => {
  if (event.key === "Enter") {
    addTask();
  }
});

elements.applyTemplate.addEventListener("click", applyTemplate);
elements.saveTemplate.addEventListener("click", saveTemplate);
elements.deleteTemplate.addEventListener("click", deleteTemplate);

elements.notifyToggle.addEventListener("click", requestNotificationPermission);
icon.svg
Новый
+5
-0

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192">
  <rect width="192" height="192" rx="32" fill="#4f46e5" />
  <rect x="40" y="50" width="112" height="92" rx="12" fill="#0f1115" />
  <path d="M60 80h72M60 104h72M60 128h48" stroke="#e5e7eb" stroke-width="10" stroke-linecap="round" />
</svg>
index.html
Новый
+105
-0

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Planner</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <meta name="theme-color" content="#0f1115" />
</head>
<body>
  <header class="app-header">
    <div class="header-left">
      <h1>Ежедневник</h1>
      <div class="date-controls">
        <button id="prev-day" class="icon-button" aria-label="Предыдущий день">◀</button>
        <input type="date" id="current-date" />
        <button id="next-day" class="icon-button" aria-label="Следующий день">▶</button>
      </div>
    </div>
    <button id="notify-toggle" class="primary">Уведомления</button>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="day">День</button>
    <button class="tab" data-tab="week">Неделя</button>
    <button class="tab" data-tab="month">Месяц</button>
    <button class="tab" data-tab="year">Год</button>
  </nav>

  <main>
    <section id="tab-day" class="tab-panel active">
      <div class="card">
        <label class="field">
          Старт дня
          <input type="time" id="day-start" value="08:00" />
        </label>
        <div class="template-actions">
          <select id="template-select"></select>
          <button id="apply-template" class="secondary">Применить</button>
          <button id="save-template" class="secondary">Сохранить как шаблон</button>
          <button id="delete-template" class="danger">Удалить шаблон</button>
        </div>
      </div>

      <div class="card">
        <h2>Добавить задачу</h2>
        <div class="task-form">
          <input type="text" id="task-title" placeholder="Название" />
          <select id="task-quadrant">
            <option value="Q1">Q1 Срочно/Важно</option>
            <option value="Q2">Q2 Важно/Не срочно</option>
            <option value="Q3">Q3 Срочно/Не важно</option>
            <option value="Q4">Q4 Не срочно/Не важно</option>
          </select>
          <input type="number" id="task-duration" min="5" step="5" value="30" />
          <button id="add-task" class="primary">Добавить</button>
        </div>
      </div>

      <div class="card">
        <h2>План дня</h2>
        <div id="task-list" class="task-list"></div>
      </div>
    </section>

    <section id="tab-week" class="tab-panel">
      <div class="card">
        <h2>Неделя</h2>
        <div id="week-view" class="grid-week"></div>
      </div>
    </section>

    <section id="tab-month" class="tab-panel">
      <div class="card">
        <h2>Месяц</h2>
        <div id="month-view" class="grid-month"></div>
      </div>
    </section>

    <section id="tab-year" class="tab-panel">
      <div class="card">
        <h2>Год</h2>
        <div id="year-view" class="grid-year"></div>
      </div>
    </section>
  </main>

  <template id="task-item-template">
    <div class="task-item">
      <div>
        <div class="task-title"></div>
        <div class="task-meta"></div>
      </div>
      <div class="task-actions">
        <button class="secondary toggle-done">Готово</button>
        <button class="secondary move-tomorrow">На завтра</button>
        <button class="danger delete-task">Удалить</button>
      </div>
    </div>
  </template>

  <script src="app.js"></script>
</body>
</html>
manifest.json
Новый
+16
-0

{
  "name": "Ежедневник",
  "short_name": "Ежедневник",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#0f1115",
  "theme_color": "#0f1115",
  "description": "Простой ежедневник с матрицей Эйзенхауэра",
  "icons": [
    {
      "src": "icon.svg",
      "sizes": "192x192",
      "type": "image/svg+xml"
    }
  ]
}
service-worker.js
Новый
+29
-0

const CACHE_NAME = "daily-planner-v1";
const ASSETS = [
  "/",
  "/index.html",
  "/styles.css",
  "/app.js",
  "/manifest.json",
  "/icon.svg"
];

self.addEventListener("install", (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME).then((cache) => cache.addAll(ASSETS))
  );
});

self.addEventListener("activate", (event) => {
  event.waitUntil(
    caches.keys().then((keys) =>
      Promise.all(keys.filter((key) => key !== CACHE_NAME).map((key) => caches.delete(key)))
    )
  );
});

self.addEventListener("fetch", (event) => {
  event.respondWith(
    caches.match(event.request).then((cached) => cached || fetch(event.request))
  );
});
styles.css
Новый
+225
-0

:root {
  color-scheme: dark;
  --bg: #0f1115;
  --card: #171b22;
  --text: #e5e7eb;
  --muted: #9ca3af;
  --accent: #4f46e5;
  --danger: #ef4444;
}

* {
  box-sizing: border-box;
  font-family: "Inter", "Segoe UI", sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
}

.app-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  gap: 16px;
}

.header-left {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.date-controls {
  display: flex;
  align-items: center;
  gap: 8px;
}

.icon-button {
  background: var(--card);
  color: var(--text);
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 16px;
}

.tabs {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  padding: 0 16px 16px;
}

.tab {
  padding: 12px;
  border-radius: 10px;
  border: none;
  background: var(--card);
  color: var(--text);
  font-size: 16px;
}

.tab.active {
  background: var(--accent);
}

main {
  padding: 0 16px 32px;
}

.card {
  background: var(--card);
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 16px;
}

h1, h2 {
  margin: 0 0 12px;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 16px;
}

input, select {
  background: #111827;
  border: 1px solid #1f2937;
  color: var(--text);
  padding: 10px;
  border-radius: 10px;
  font-size: 16px;
}

.task-form {
  display: grid;
  gap: 10px;
  grid-template-columns: 1fr;
}

.primary, .secondary, .danger {
  padding: 12px 16px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
}

.primary {
  background: var(--accent);
  color: white;
}

.secondary {
  background: #111827;
  color: var(--text);
}

.danger {
  background: var(--danger);
  color: white;
}

.template-actions {
  display: grid;
  gap: 10px;
  grid-template-columns: 1fr;
}

.task-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.task-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-radius: 12px;
  background: #111827;
}

.task-title {
  font-size: 16px;
  font-weight: 600;
}

.task-meta {
  font-size: 14px;
  color: var(--muted);
}

.task-actions {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.grid-week, .grid-month, .grid-year {
  display: grid;
  gap: 10px;
}

.grid-week {
  grid-template-columns: repeat(2, 1fr);
}

.grid-month {
  grid-template-columns: repeat(7, 1fr);
}

.grid-year {
  grid-template-columns: repeat(3, 1fr);
}

.day-cell {
  background: #111827;
  padding: 10px;
  border-radius: 10px;
  min-height: 60px;
  font-size: 12px;
  color: var(--muted);
}

.day-cell strong {
  display: block;
  color: var(--text);
  margin-bottom: 6px;
}

.tab-panel {
  display: none;
}

.tab-panel.active {
  display: block;
}

@media (min-width: 720px) {
  .task-form {
    grid-template-columns: 2fr 1fr 1fr auto;
  }

  .template-actions {
    grid-template-columns: 2fr repeat(3, auto);
    align-items: center;
  }

  .task-actions {
    flex-direction: row;
  }

  .grid-week {
    grid-template-columns: repeat(4, 1fr);
  }
}
